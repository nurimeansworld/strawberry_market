<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>팔로워 - 딸기마켓</title>
  <link rel="stylesheet" href="../css/default.css">
</head>

<body>
  <div class="nav-skip">
    <a href="#gnb">메뉴 바로가기</a>
    <a href="#content">본문 바로가기</a>
  </div>
  <header class="nav nav-follow container">
    <button type="button" class="btn-back"><img src="../assets/icon/icon-arrow-left.png" alt="뒤로가기"></button>
    <p>Followers</p>
  </header>
  <main>
    <section class="container">
      <h1 class="sr-only">팔로워</h1>
      <!-- TODO:: api 완료 -->
      <!-- TODO:: 팔로워/팔로잉 페이지로 구분 -->

      <!-- 1. 리스트 -->
      <section id="content" class="follow-sec">
        <h2 class="sr-only">팔로워 리스트</h2>
        <ul class="follow-list">
          <li class="follow-item">
            <a href="javascript:void(0);" class="user-follow-bar">
              <img src="../assets/basic-profile-img-2.png" alt="사용자 이미지" class="user-image">
              <div class="user-follow-info">
                <span>{애월읍 한라봉 최고 맛집}</span>
                <div class="user-email">{정성을 다해 농사짓는 한라봉}</div>
              </div>
            </a>
            <button type="button" class="small-follow-button">{팔로우}</button>
          </li>
          <li class="follow-item">
            <a href="javascript:void(0);" class="user-follow-bar">
              <img src="../assets/basic-profile-img-2.png" alt="사용자 이미지" class="user-image">
              <div class="user-follow-info">
                <span>{감귤의 품격 - 애월읍}</span>
                <div class="user-email">
                  {제주 노지귤, 하우스 한라봉 판매합니다. 제주 노지귤, 하우스 한라봉 판매합니다. 제주 노지귤, 하우스 한라봉 판매합니다. 제주 노지귤}
                </div>
              </div>
            </a>
            <button type="button" class="small-follow-button">{팔로우}</button>
          </li>
        </ul>
      </section>
      <!-- // 1. 리스트 -->
      <!-- 2. 탭 메뉴 -->
      <nav class="tab-menu" id="gnb">
        <ul class=" tab-menu-list">
          <li class="tab-menu-home">
            <a href="./H01.html">홈</a>
          </li>
          <li class="tab-menu-chat">
            <a href="./C01.html">채팅</a>
          </li>
          <li class="tab-menu-post">
            <a href="./U02.html">게시물 작성</a>
          </li>
          <li class="tab-menu-profile on">
            <a href="./P02.html">프로필</a>
          </li>
        </ul>
      </nav>
      <!-- // 2. 탭 메뉴 -->

    </section>
  </main>

  <script src="../js/script.js"></script>
  <script src="../js/script_NR.js"></script>
  <script>
    // follow 상태 변경
    const followList = document.querySelector('.follow-list');
    followList.addEventListener('click', function (e) {
      if (e.target.nodeName === "BUTTON") {
        btn = e.target;

        if (btn.classList.contains('cancel-button')) {
          // console.log(btn.className);
          btn.classList.remove('cancel-button');
          btn.classList.add('small-follow-button');
          btn.textContent = '팔로우';
        } else {
          btn.classList.remove('small-follow-button');
          btn.classList.add('cancel-button');
          btn.textContent = '취소';
        }
      }
    });
  </script>
  <script>
    function setFollower(userInfo) {
      console.log('userInfo', userInfo);
      const followList = document.querySelector('.follow-list');

      for (const user of userInfo) {
        console.log(user);

        // 유저 정보
        const user_accountname = user.accountname;
        const user_username = user.username;
        const user_intro = user.intro;
        const user_image = user.image;
        //  TODO:: 실제 데이터에 맞춰서 class, text 값 다르게 받아오기
        const stateClass = 'small-follow-button';
        const stateText = '팔로우';


        const fragment = document.createDocumentFragment();
        const followItem = document.createElement('li');
        const btn = document.createElement('button');

        followItem.innerHTML = `<a href="javascript:void(0);" class="user-follow-bar">
          <img src="${user_image}" alt="사용자 이미지" class="user-image">
            <div class="user-follow-info">
              <span>${user_username}</span>
              <div class="user-email">
                ${user_intro}
              </div>
            </div>
        </a>
        <button type="button" class="${stateClass}">${stateText}</button>
        `;
        followItem.setAttribute('class', 'follow-item');
        followList.appendChild(followItem);
        fragment.appendChild(followItem);
      }
      followList.appendChild(fragment);
    }

    async function getFollower() {
      // // paging limit skip
      // GET / profile /: accountname / follower ? limit = Number & skip=Number

      const url = 'http://146.56.183.55:5050';
      const accountName = 'sadlooply';
      // !중!요!
      const token = localStorage.getItem('Token');
      const init = {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-type': 'application/json'
        }
      }
      const res = await fetch(`${url}/profile/${accountName}/follower`, init);
      const resJson = await res.json();
      // console.log(resJson);

      setFollower(resJson);
    }

    getFollower();
  </script>
</body>

</html>