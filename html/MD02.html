<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3.1.16 Modal (희정) 내가 작성한 게시글일 경우 : 삭제, 수정 버튼 </title>
  <link rel="stylesheet" href="../css/default.css">
  </head>
  <body>
      <!-- 게시판 유저 메뉴 버튼   -->
        <div class="home-post-user ">
          <img class="user-profile" src="../assets/small-profile-img.png" alt="회원 프로필">
          <h4 class="user-name">애월읍 위니브 감귤농장</h4>
          <p class="user-id">@ weniv_Mandarin</p>
          <button type="button" class="btn-menu user-menu"><img src="../assets/icon/icon-more-vertical.png"
              alt="메뉴 열기"></button>
        </div>
    
        <section class="modal2 hidden">
          <div class="hidden-menu">
          <ul class="hidden-menu-list">
            <li>
              <button type="button" class="delete-post">삭제</button>
            </li>
            <li>
              <a class="edit-post" onClick="location.href='P05_1.html'">수정</a>
            </li>
          </ul>
          </div>
        </section>
    
      <section class="dimm off">
      <div class="alert-modal">
        <div class="alert-modal-wrap">
          <strong class="alert-msg">게시글을 삭제할까요?</strong>       
        <ul class="alert-menu-list">
          <li>
            <button type="button" class="cancle-btn">취소</button>
          
          </li>
          <li>
            <button type="button" class="delete-btn">삭제</button>
          </li>
        </ul>
      </div>
      </div>
      </section>
      
  <script>
    const open2 = () => {
      document.querySelector(".modal2").classList.remove("hidden");
    }
    const close2 = () => {
      document.querySelector(".modal2").classList.add("hidden");   
    }  

    document.querySelector(".user-menu").addEventListener("click", open2);
    document.querySelector(".hidden-menu").addEventListener("click", close2); 

    const btn2 = document.querySelector('.delete-post');
    const pop2 = document.querySelector('.dimm');
    const out2 = document.querySelector('.cancle-btn');
    const del2 = document.querySelector('.delete-btn');

        btn2.addEventListener('click',viewOption);
        out2.addEventListener('click',cancleOption);
        del2.addEventListener('click',cancleOption);

        function viewOption() {
            console.log(pop2);
            pop2.style.display = 'block';
        }
        function cancleOption() {
          pop2.style.display = 'none';
        }
    


   // http://127.0.0.1:5503/html/MD02.html?postId=61ff60609d09d36b213726f0
    // 게시물 삭제 
    // 게시물 임시 url 


    // http://127.0.0.1:5503/html/MD02.html?postId=61ffe64e9d09d36b21376ee9
    // 게시물 수정



    const postId = new URLSearchParams(location.search).get('postId'); 
    
    
    //상품 삭제 API (삭제 버튼 .delete-btn)  상품 삭제 되있는지 확인 상품이 없다 - 상품 등록이 안됨 

    // const del2 = document.querySelector('.delete-btn');

    async function deletePost(){
      
      // 버튼을 누른다 -> 삭제 (API코드를 짠다(명세보기필요한정보를 받아서 보냄 ) - 요청을 보낸다 - 결과를 확인 )
        const url = 'http://146.56.183.55:5050';
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYxZmNjMjNkOWQwOWQzNmIyMTM2ZTk3MCIsImV4cCI6MTY0OTI2MDUzNiwiaWF0IjoxNjQ0MDc2NTM2fQ.dgflqthibSYSMd5p6EXqd-IdeHts0tv9fmLJjh-GOt4'

        try {
          const res = await fetch( `${url}/post/${postId}`, {
            method: 'DELETE',
            headers: {
              'Authorization' : `Bearer ${token}`,
              'Content-type' : 'application/json'
            }
          });
          const json = await res.json();
          console.log(json);
      
    
            
      } catch(err) {
        console.log(err);
      }
    };
    del2.addEventListener('click', deletePost);




    // const postId = new URLSearchParams(location.search).get('postId'); 
    
    
    상품 수정 API (수정 버튼 .edit-post) 

    const editAlert = document.querySelector('.edit-post');
    const image = document.querySelector

    게시물 이미지 업로드  판단
    const image = (image.value !== '') ? image.value : '';

    async function editPost(){
      
      // 버튼을 누른다 -> 수정 (API코드를 짠다(명세보기필요한정보를 받아서 보냄 ) - 요청을 보낸다 - 결과를 확인 )
        const url = 'http://146.56.183.55:5050';

        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYxZmNjMjNkOWQwOWQzNmIyMTM2ZTk3MCIsImV4cCI6MTY0OTI2MDUzNiwiaWF0IjoxNjQ0MDc2NTM2fQ.dgflqthibSYSMd5p6EXqd-IdeHts0tv9fmLJjh-GOt4'
        // const image 
        try {
          const res = await fetch( `${url}/post/${postId}`, {
            method: 'PUT',
            headers: {
              'Authorization' : `Bearer ${token}`,
              'Content-type' : 'application/json'
            },
            body:JSON.stringify({
              "post": {
                "content": String,
                "image": String  
		            }
            })
            
          });
          const json = await res.json();
          console.log(json);
        

            
      } catch(err) {
        console.log(err);
      }
    };
    editAlert.addEventListener('click', editPost);

    </script>
  </body>
  </html>  
  
